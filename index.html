<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Stok Opname Otomatis</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #result { margin-top: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  </style>
</head>
<body>

<h2>Stok Opname Otomatis dengan Scan Kamera</h2>

<div id="reader" style="width: 300px;"></div>

<div id="result">
  <h3>Daftar Scan</h3>
  <table id="scanTable">
    <thead>
      <tr><th>No</th><th>Kode Barang / Angka</th></tr>
    </thead>
    <tbody></tbody>
    <tfoot>
      <tr><td colspan="1"><b>Total Scan:</b></td><td id="totalScan">0</td></tr>
    </tfoot>
  </table>
</div>

<script>
  let scanResults = [];
  const scanTableBody = document.querySelector("#scanTable tbody");
  const totalScanCell = document.getElementById("totalScan");

  function updateTable() {
    scanTableBody.innerHTML = "";
    scanResults.forEach((code, idx) => {
      let row = document.createElement("tr");
      row.innerHTML = `<td>${idx+1}</td><td>${code}</td>`;
      scanTableBody.appendChild(row);
    });
    // Hitung total jumlah (asumsikan kode barang adalah angka)
    let total = scanResults.reduce((sum, val) => {
      let num = parseFloat(val);
      return sum + (isNaN(num) ? 0 : num);
    }, 0);
    totalScanCell.textContent = total;
  }

  function onScanSuccess(decodedText, decodedResult) {
    // decodedText adalah string hasil scan barcode/QR
    console.log(`Scan hasil: ${decodedText}`);
    scanResults.push(decodedText);
    updateTable();
  }

  function onScanFailure(error) {
    // bisa dibiarkan kosong atau tampilkan pesan
  }

  // Inisialisasi scanner
  let html5QrcodeScanner = new Html5QrcodeScanner(
    "reader", { fps: 10, qrbox: 250 });
  html5QrcodeScanner.render(onScanSuccess, onScanFailure);
</script>

</body>
</html>
